# MicroOS Tools
Files and scripts for openSUSE MicroOS

## /tmp on tmpfs with noexec flag

MicroOS will use tmpfs for /tmp with noexec flag set in the future.
For this reasons, salt-minion will write it's temporary files into
/run/salt-tmp.
In general, daemons should use private disk space for their data
and not shared one in /tmp.

## SELinux

MicroOS has support for SELinux.
If the file `/etc/selinux/.autorelabel` exists, the dracut module
`98selinux-microos` will label the root filesystem including
`/etc` and `/var`. The selinux-autorelabel-generator will generate
services to relabel other mountpoints during boot.

There is a script for automated testing of this in test/test.sh.

## locale-check

MicroOS supports only a limited number of locales (C, C.utf8, en_US.utf8,
POSIX). If you login via SSH, the locale settings will be verified that
they exist on this system. If not, locale is reset to the system default.

## systemd services

### import-pubring-from-rpmdb.service

The `import-pubring-from-rpmdb.service` imports the keys from rpmdb int
`/etc/systemd/import-pubring.gpg`.

### printenv.service

The `printenv.service` is to debug which environment variables exist
by default. It just calls `printenv`.

## development tools

* microos-rw: switches the root file system to read-write
* microos-ro: resets btrfs property to read-only again.
* rpmorphan: display files not owned by rpm
* rpm-sortbysize: list all installed packages sorted by size

## Building a Custom ISO Using Docker

The `docker` directory contains a sample `Dockerfile`, a `docker-compose.yml`, and a minimal KIWI description. These files allow building an openSUSE MicroOS based ISO image inside a Docker container.

### Prerequisites

* Docker and Docker Compose must be installed on the host system. On
  Debian/Ubuntu based hosts you can install them with:

  ```bash
  sudo apt-get install docker.io docker-compose
  sudo systemctl enable --now docker
  ```

* The build container requires privileged mode and access to `/dev` to create
  loop devices during the KIWI build.

### Steps

1. Build the Docker image and run the build container using the helper script.
   The compose file already enables privileged mode and mounts `/dev` for KIWI:

   ```bash
   cd docker
   ./build.sh
   ```

2. The resulting ISO file will be written to the `output` directory in the
   repository root. The filename is generated by KIWI based on the image name
   and version defined in the `.kiwi` description.

The provided KIWI description is intentionally minimal and can be extended to fit specific needs.
